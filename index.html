<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant POS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1e293b;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Main Container */
        .container {
            display: flex;
            height: calc(100vh - 70px);
        }

        /* Tables Sidebar */
        .tables-sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 20px;
            overflow-y: auto;
        }

        .tables-sidebar h3 {
            color: #3b82f6;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .table-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .table-card.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .table-card.vacant {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .table-card.occupied {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .table-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
        }

        .table-status {
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
            text-transform: uppercase;
        }

        .table-amount {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 5px;
        }

        /* Menu Area */
        .menu-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .menu-item {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-item:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .menu-item h4 {
            color: #1e293b;
            margin-bottom: 5px;
        }

        .menu-item-category {
            color: #64748b;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .menu-item-price {
            color: #10b981;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .menu-item-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #3b82f6;
            background: white;
            border-radius: 6px;
            color: #3b82f6;
            font-weight: bold;
            cursor: pointer;
        }

        .qty-btn:hover {
            background: #3b82f6;
            color: white;
        }

        .qty-display {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
        }

        /* Order Panel */
        .order-panel {
            width: 350px;
            background: white;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
        }

        .order-header {
            padding: 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .order-header h3 {
            font-size: 1.2rem;
        }

        .order-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-item-name {
            flex: 1;
        }

        .order-item-qty {
            margin: 0 10px;
            font-weight: bold;
        }

        .order-item-price {
            color: #10b981;
            font-weight: bold;
        }

        .order-footer {
            padding: 20px;
            border-top: 2px solid #e2e8f0;
        }

        .order-total {
            text-align: right;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1e293b;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-buttons .btn {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
        }

        .btn-primary {
            background: #3b82f6;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sync-status.online {
            color: #10b981;
        }

        .sync-status.offline {
            color: #ef4444;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            color: #3b82f6;
            margin-bottom: 20px;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .payment-method {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: #3b82f6;
        }

        .payment-method.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .tables-sidebar {
                width: 100%;
                height: 150px;
                overflow-x: auto;
            }
            
            .tables-grid {
                display: flex;
                flex-wrap: nowrap;
            }
            
            .table-card {
                min-width: 100px;
            }
            
            .order-panel {
                width: 100%;
                height: 300px;
                position: fixed;
                bottom: 40px;
                left: 0;
                right: 0;
                border-top: 2px solid #e2e8f0;
                border-left: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üçΩÔ∏è Restaurant POS</h1>
        <div class="header-buttons">
            <a href="kitchen.html" class="btn btn-outline">üë®‚Äçüç≥ Kitchen</a>
            <a href="server.html" class="btn btn-outline">üñ•Ô∏è Server View</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Tables Sidebar -->
        <div class="tables-sidebar">
            <h3>Tables</h3>
            <div class="tables-grid" id="tables-list"></div>
        </div>

        <!-- Menu Area -->
        <div class="menu-area">
            <h3>Menu Items</h3>
            <div class="menu-grid" id="menu-grid"></div>
        </div>

        <!-- Order Panel -->
        <div class="order-panel">
            <div class="order-header">
                <h3 id="current-table-title">Select a Table</h3>
            </div>
            <div class="order-body" id="order-items"></div>
            <div class="order-footer">
                <div class="order-total">
                    Total: <span id="order-total">$0.00</span>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="submitOrder()">Submit Order</button>
                    <button class="btn btn-success" onclick="showCheckoutModal()" id="checkout-btn" style="display: none;">Checkout</button>
                    <button class="btn btn-secondary" onclick="clearOrder()">Clear Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div id="sync-status" class="sync-status online">üü¢ Synced</div>
        <div id="last-update">Last update: Just now</div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkout-modal">
        <div class="modal">
            <h2>Checkout - Table <span id="checkout-table-number"></span></h2>
            <div id="checkout-items-list"></div>
            <div class="order-total" style="margin: 20px 0;">
                Total: <span id="checkout-total">$0.00</span>
            </div>
            
            <h4>Payment Method</h4>
            <div class="payment-methods">
                <div class="payment-method" onclick="selectPayment('cash')">
                    <div style="font-size: 1.5rem;">üíµ</div>
                    <div>Cash</div>
                </div>
                <div class="payment-method" onclick="selectPayment('card')">
                    <div style="font-size: 1.5rem;">üí≥</div>
                    <div>Card</div>
                </div>
                <div class="payment-method" onclick="selectPayment('upi')">
                    <div style="font-size: 1.5rem;">üì±</div>
                    <div>UPI</div>
                </div>
                <div class="payment-method" onclick="selectPayment('split')">
                    <div style="font-size: 1.5rem;">‚ÜîÔ∏è</div>
                    <div>Split</div>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="processCheckout()">Complete Payment</button>
                <button class="btn btn-secondary" onclick="hideModal('checkout-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notification-container"></div>

    <script>
        // ==================== LOCAL STORAGE SERVER SIMULATION ====================
        const SERVER_KEY = 'restaurant_pos_server_data';
        const UPDATE_INTERVAL = 2000; // 2 seconds

        // Server data structure
        let serverData = {
            tables: [],
            menu: [],
            orders: [],
            transactions: [],
            lastUpdate: null,
            deviceId: generateDeviceId()
        };

        // Current device state
        let currentState = {
            tables: [],
            menu: [],
            currentTable: null,
            currentOrder: [],
            selectedPayment: null
        };

        // ==================== INITIALIZATION ====================
        function init() {
            loadInitialData();
            setupEventListeners();
            startSyncLoop();
            renderTables();
            renderMenu();
            updateOrderPanel();
            updateStatusBar();
        }

        function generateDeviceId() {
            let id = localStorage.getItem('device_id');
            if (!id) {
                id = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('device_id', id);
            }
            return id;
        }

        function loadInitialData() {
            // Try to load from server
            const saved = localStorage.getItem(SERVER_KEY);
            if (saved) {
                try {
                    serverData = JSON.parse(saved);
                    
                    // Check if we need to initialize demo data
                    if (serverData.tables.length === 0) {
                        initDemoData();
                        saveToServer();
                    }
                    
                    syncFromServer();
                    
                } catch (e) {
                    console.error('Error loading server data:', e);
                    initDemoData();
                    saveToServer();
                }
            } else {
                initDemoData();
                saveToServer();
            }
        }

        function initDemoData() {
            // Create tables
            serverData.tables = [];
            for (let i = 1; i <= 12; i++) {
                serverData.tables.push({
                    id: `table_${i}`,
                    number: i,
                    name: `Table ${i}`,
                    capacity: i <= 4 ? 2 : i <= 8 ? 4 : 6,
                    status: 'vacant',
                    currentOrder: [],
                    lastUpdate: new Date().toISOString()
                });
            }

            // Create menu
            serverData.menu = [
                { id: 'item_1', name: 'Veg Burger', category: 'Main', price: 8.99, stock: 50 },
                { id: 'item_2', name: 'Chicken Burger', category: 'Main', price: 10.99, stock: 50 },
                { id: 'item_3', name: 'French Fries', category: 'Sides', price: 4.99, stock: 50 },
                { id: 'item_4', name: 'Onion Rings', category: 'Sides', price: 5.99, stock: 50 },
                { id: 'item_5', name: 'Coca Cola', category: 'Drinks', price: 2.99, stock: 50 },
                { id: 'item_6', name: 'Sprite', category: 'Drinks', price: 2.99, stock: 50 },
                { id: 'item_7', name: 'Water', category: 'Drinks', price: 1.99, stock: 50 },
                { id: 'item_8', name: 'Ice Cream', category: 'Dessert', price: 4.99, stock: 50 },
                { id: 'item_9', name: 'Cheese Pizza', category: 'Main', price: 12.99, stock: 50 },
                { id: 'item_10', name: 'Garlic Bread', category: 'Sides', price: 6.99, stock: 50 }
            ];

            serverData.orders = [];
            serverData.transactions = [];
            serverData.lastUpdate = new Date().toISOString();
        }

        // ==================== SERVER SYNC ====================
        function saveToServer() {
            serverData.lastUpdate = new Date().toISOString();
            localStorage.setItem(SERVER_KEY, JSON.stringify(serverData));
            
            // Trigger storage event for other tabs
            window.dispatchEvent(new StorageEvent('storage', {
                key: SERVER_KEY,
                newValue: JSON.stringify(serverData)
            }));
            
            updateStatusBar();
        }

        function syncFromServer() {
            const saved = localStorage.getItem(SERVER_KEY);
            if (saved) {
                try {
                    const newData = JSON.parse(saved);
                    
                    // Only update if server data is newer
                    if (!serverData.lastUpdate || new Date(newData.lastUpdate) > new Date(serverData.lastUpdate)) {
                        serverData = newData;
                        
                        // Update local state
                        currentState.tables = [...serverData.tables];
                        currentState.menu = [...serverData.menu];
                        
                        // Update UI
                        renderTables();
                        renderMenu();
                        
                        // If we have a current table, update its data
                        if (currentState.currentTable) {
                            const table = currentState.tables.find(t => t.id === currentState.currentTable);
                            if (table) {
                                currentState.currentOrder = table.currentOrder || [];
                                updateOrderPanel();
                            }
                        }
                        
                        showNotification('Data synced from server', 'info');
                    }
                    
                } catch (e) {
                    console.error('Error syncing from server:', e);
                }
            }
        }

        function startSyncLoop() {
            setInterval(() => {
                syncFromServer();
            }, UPDATE_INTERVAL);
        }

        function setupEventListeners() {
            // Listen for changes from other tabs
            window.addEventListener('storage', (e) => {
                if (e.key === SERVER_KEY) {
                    syncFromServer();
                    showNotification('Data updated from another device', 'info');
                }
            });
            
            // Listen for online/offline status
            window.addEventListener('online', () => {
                document.getElementById('sync-status').className = 'sync-status online';
                document.getElementById('sync-status').textContent = 'üü¢ Synced';
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('sync-status').className = 'sync-status offline';
                document.getElementById('sync-status').textContent = 'üî¥ Offline';
            });
        }

        // ==================== UI FUNCTIONS ====================
        function renderTables() {
            const container = document.getElementById('tables-list');
            container.innerHTML = currentState.tables.map(table => {
                const orderTotal = (table.currentOrder || []).reduce((sum, item) => 
                    sum + (item.price * item.quantity), 0);
                
                return `
                    <div class="table-card ${table.status} ${currentState.currentTable === table.id ? 'active' : ''}" 
                         onclick="selectTable('${table.id}')">
                        <div class="table-number">${table.number}</div>
                        <div class="table-status">${table.status}</div>
                        ${orderTotal > 0 ? 
                            `<div class="table-amount">$${orderTotal.toFixed(2)}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderMenu() {
            const container = document.getElementById('menu-grid');
            container.innerHTML = currentState.menu.map(item => {
                const currentQty = getOrderQuantity(item.id);
                return `
                    <div class="menu-item">
                        <h4>${item.name}</h4>
                        <div class="menu-item-category">${item.category}</div>
                        <div class="menu-item-price">$${item.price.toFixed(2)}</div>
                        <div class="menu-item-controls">
                            <button class="qty-btn" onclick="adjustQuantity('${item.id}', -1)">-</button>
                            <div class="qty-display">${currentQty}</div>
                            <button class="qty-btn" onclick="adjustQuantity('${item.id}', 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateOrderPanel() {
            const itemsContainer = document.getElementById('order-items');
            const totalElement = document.getElementById('order-total');
            const tableTitle = document.getElementById('current-table-title');
            const checkoutBtn = document.getElementById('checkout-btn');

            if (currentState.currentTable) {
                const table = currentState.tables.find(t => t.id === currentState.currentTable);
                if (table) {
                    tableTitle.textContent = `Table ${table.number}`;
                    checkoutBtn.style.display = table.status === 'occupied' ? 'block' : 'none';
                }
            } else {
                tableTitle.textContent = 'Select a Table';
                checkoutBtn.style.display = 'none';
            }

            if (currentState.currentOrder.length === 0) {
                itemsContainer.innerHTML = '<div style="color: #64748b; text-align: center; padding: 20px;">No items added</div>';
                totalElement.textContent = '$0.00';
                return;
            }

            itemsContainer.innerHTML = currentState.currentOrder.map(item => `
                <div class="order-item">
                    <div class="order-item-name">${item.name}</div>
                    <div class="order-item-qty">x${item.quantity}</div>
                    <div class="order-item-price">$${(item.price * item.quantity).toFixed(2)}</div>
                </div>
            `).join('');

            const total = currentState.currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalElement.textContent = `$${total.toFixed(2)}`;
        }

        function updateStatusBar() {
            const lastUpdateEl = document.getElementById('last-update');
            if (serverData.lastUpdate) {
                const date = new Date(serverData.lastUpdate);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000);
                
                if (diff < 60) {
                    lastUpdateEl.textContent = 'Last update: Just now';
                } else if (diff < 3600) {
                    const mins = Math.floor(diff / 60);
                    lastUpdateEl.textContent = `Last update: ${mins} min${mins > 1 ? 's' : ''} ago`;
                } else {
                    lastUpdateEl.textContent = `Last update: ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                }
            }
        }

        // ==================== ORDER MANAGEMENT ====================
        function selectTable(tableId) {
            currentState.currentTable = tableId;
            const table = currentState.tables.find(t => t.id === tableId);
            
            if (table) {
                currentState.currentOrder = table.currentOrder || [];
                updateOrderPanel();
                renderTables();
                renderMenu();
            }
        }

        function getOrderQuantity(itemId) {
            const item = currentState.currentOrder.find(item => item.id === itemId);
            return item ? item.quantity : 0;
        }

        function adjustQuantity(itemId, change) {
            if (!currentState.currentTable) {
                showNotification('Please select a table first', 'error');
                return;
            }

            const menuItem = currentState.menu.find(item => item.id === itemId);
            if (!menuItem) return;

            let orderItem = currentState.currentOrder.find(item => item.id === itemId);

            if (orderItem) {
                orderItem.quantity += change;
                if (orderItem.quantity <= 0) {
                    currentState.currentOrder = currentState.currentOrder.filter(item => item.id !== itemId);
                }
            } else if (change > 0) {
                currentState.currentOrder.push({
                    id: itemId,
                    name: menuItem.name,
                    price: menuItem.price,
                    quantity: 1
                });
            }

            updateOrderPanel();
            renderMenu();
        }

        function submitOrder() {
            if (!currentState.currentTable) {
                showNotification('Please select a table', 'error');
                return;
            }

            if (currentState.currentOrder.length === 0) {
                showNotification('Please add items to order', 'error');
                return;
            }

            // Update table in server data
            const tableIndex = serverData.tables.findIndex(t => t.id === currentState.currentTable);
            if (tableIndex !== -1) {
                serverData.tables[tableIndex].status = 'occupied';
                serverData.tables[tableIndex].currentOrder = [...currentState.currentOrder];
                serverData.tables[tableIndex].lastUpdate = new Date().toISOString();
                
                // Create kitchen order
                const orderId = `order_${Date.now()}`;
                serverData.orders.push({
                    id: orderId,
                    tableId: currentState.currentTable,
                    tableNumber: serverData.tables[tableIndex].number,
                    items: [...currentState.currentOrder],
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    createdBy: serverData.deviceId
                });
                
                saveToServer();
                
                // Clear current order
                currentState.currentOrder = [];
                updateOrderPanel();
                renderMenu();
                renderTables();
                
                showNotification('Order submitted to kitchen!', 'success');
            }
        }

        function showCheckoutModal() {
            if (!currentState.currentTable) return;
            
            const table = currentState.tables.find(t => t.id === currentState.currentTable);
            if (!table || table.status !== 'occupied') return;
            
            const items = table.currentOrder || [];
            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('checkout-table-number').textContent = table.number;
            document.getElementById('checkout-total').textContent = `$${total.toFixed(2)}`;
            
            const itemsList = document.getElementById('checkout-items-list');
            itemsList.innerHTML = items.map(item => `
                <div class="order-item">
                    <div class="order-item-name">${item.name}</div>
                    <div class="order-item-qty">x${item.quantity}</div>
                    <div class="order-item-price">$${(item.price * item.quantity).toFixed(2)}</div>
                </div>
            `).join('');
            
            showModal('checkout-modal');
        }

        function selectPayment(method) {
            currentState.selectedPayment = method;
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('active'));
            event.target.closest('.payment-method').classList.add('active');
        }

        function processCheckout() {
            if (!currentState.selectedPayment) {
                showNotification('Please select payment method', 'error');
                return;
            }

            const tableIndex = serverData.tables.findIndex(t => t.id === currentState.currentTable);
            if (tableIndex === -1) return;
            
            const table = serverData.tables[tableIndex];
            const items = table.currentOrder || [];
            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Create transaction
            serverData.transactions.push({
                id: `txn_${Date.now()}`,
                tableId: currentState.currentTable,
                tableNumber: table.number,
                items: items,
                total: total,
                paymentMethod: currentState.selectedPayment,
                status: 'completed',
                timestamp: new Date().toISOString(),
                processedBy: serverData.deviceId
            });
            
            // Update table
            serverData.tables[tableIndex].status = 'vacant';
            serverData.tables[tableIndex].currentOrder = [];
            serverData.tables[tableIndex].lastUpdate = new Date().toISOString();
            
            // Remove kitchen orders for this table
            serverData.orders = serverData.orders.filter(order => 
                order.tableId !== currentState.currentTable || order.status === 'completed'
            );
            
            saveToServer();
            
            // Reset UI
            currentState.currentOrder = [];
            currentState.selectedPayment = null;
            hideModal('checkout-modal');
            updateOrderPanel();
            renderTables();
            
            showNotification(`Payment of $${total.toFixed(2)} completed!`, 'success');
        }

        function clearOrder() {
            if (!confirm('Clear current order?')) return;
            
            currentState.currentOrder = [];
            updateOrderPanel();
            renderMenu();
            showNotification('Order cleared', 'info');
        }

        // ==================== MODAL FUNCTIONS ====================
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ==================== INITIALIZE ====================
        window.addEventListener('load', init);
    </script>
</body>
</html>
